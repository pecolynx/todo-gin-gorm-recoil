---
desc: Generated by `runn new`
runners:
  db: mysql://user:password@localhost:3306/todo?charset=utf8mb4&parseTime=True
  req: http://localhost:8080
steps:
  clearTodos:
    db:
      query: "DELETE FROM todos"
  fetchTodos1:
    req:
      /api/todo:
        get:
          body: null
    test: |
      current.res.status == 200
      && current.res.headers["Content-Type"][0] == "application/json; charset=utf-8"
      && "Date" in current.res.headers
      && len(current.res.body) == 0
  createTodo:
    req:
      /api/todo:
        post:
          body:
            application/json:
              text: abc
    test: |
      current.res.status == 201
      && current.res.headers["Content-Type"][0] == "application/json; charset=utf-8"
      && "Date" in current.res.headers
      && current.res.body.text == "abc"
      && current.res.body.isComplete == false

  getTodo1:
    req:
      /api/todo/{{ steps.createTodo.res.body.id }}:
        get:
          body: null
    test: |
      current.res.status == 200
      && current.res.headers["Content-Type"][0] == "application/json; charset=utf-8"
      && "Date" in current.res.headers
      && current.res.body.text == "abc"
      && current.res.body.isComplete == false

  updateText:
    req:
      /api/todo/{{ steps.createTodo.res.body.id }}:
        put:
          body:
            application/json:
              text: def
    test: |
      current.res.status == 200
      && current.res.headers["Content-Type"][0] == "application/json; charset=utf-8"
      && "Date" in current.res.headers
      && current.res.body.text == "def"
      && current.res.body.isComplete == false

  completeTodo:
    req:
      /api/todo/{{ steps.createTodo.res.body.id }}:
        put:
          body:
            application/json:
              text: def
              isComplete: true
    test: |
      current.res.status == 200
      && current.res.headers["Content-Type"][0] == "application/json; charset=utf-8"
      && "Date" in current.res.headers
      && current.res.body.text == "def"
      && current.res.body.isComplete == true

  deleteTodo:
    req:
      /api/todo/{{ steps.createTodo.res.body.id }}:
        delete:
          body: null
    test: |
      current.res.status == 204
      && "Date" in current.res.headers
      && "Content-Length" not in current.res.headers

  getTodo2:
    req:
      /api/todo/{{ steps.createTodo.res.body.id }}:
        get:
          body: null
    test: |
      current.res.status == 404
      && "Date" in current.res.headers
      && current.res.headers['Content-Length'][0] == "0"
